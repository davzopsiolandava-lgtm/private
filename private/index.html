<!-- controlled.html (tempel di private page) -->
<script>
  const bc = new BroadcastChannel('davz-control');

  // data in-memory (atau bisa gunakan localStorage jika ingin persist)
  let vipListText = document.getElementById('vipList')?.textContent || '';
  // jika kamu punya struktur akun di halaman private:
  let accounts = []; // { user, pass } â€” isi sesuai implementasimu

  // helper: render vipList ke DOM
  function renderVipList() {
    const el = document.getElementById('vipList');
    if (!el) return;
    el.textContent = vipListText;
  }

  // helper: render accounts (sesuaikan)
  function renderAccounts() {
    const el = document.getElementById('accountList');
    if (!el) return;
    el.textContent = accounts.map(a => `- ${a.user}`).join('\\n');
  }

  // jalankan awal
  renderVipList();
  renderAccounts();

  // handler pesan dari controller
  bc.onmessage = (ev) => {
    const msg = ev.data;
    console.log('Controlled menerima:', msg);
    const { action, payload } = msg;

    if (action === 'addID') {
      const { id, owner, note } = payload;
      // contoh format yang sama seperti daftarmu
      vipListText += `\\n\\n---\\n\\n${id}\\n-${owner}\\n${note}`;
      renderVipList();

      // optional: kirim konfirmasi kembali ke controller
      bc.postMessage({ action:'ack', status:'ok', for:'addID', id });
    }

    else if (action === 'deleteID') {
      const { id } = payload;
      // cari baris yang cocok dan hapus bloknya
      const lines = vipListText.split('\\n');
      const idx = lines.findIndex(l => l.trim() === id);
      if (idx !== -1) {
        lines.splice(Math.max(0, idx-1), 5); // hapus blok
        vipListText = lines.join('\\n');
        renderVipList();
        bc.postMessage({ action:'ack', status:'ok', for:'deleteID', id });
      } else {
        bc.postMessage({ action:'ack', status:'not-found', for:'deleteID', id });
      }
    }

    else if (action === 'updatePassword') {
      const { username, password } = payload;
      const found = accounts.find(a => a.user === username);
      if (found) {
        found.pass = password;
      } else {
        accounts.push({ user: username, pass: password });
      }
      renderAccounts();
      bc.postMessage({ action:'ack', status:'ok', for:'updatePassword', username });
    }

    // tambahkan aksi lain sesuai kebutuhan
  };

  // optional: bersihkan channel saat unload
  window.addEventListener('beforeunload', () => {
    bc.close();
  });
</script>

<!-- Contoh elemen DOM di halaman private -->
<pre id="vipList">-187480083
-davz1231
[TECNO LI7]

---

-184647956
-davz1231
[AIRLANGGA]</pre>

<pre id="accountList"></pre>
